import{g as h,d as J,h as c,i,o as M,j as O,c as o,a as s,b as q,f as B,t as n,F as g,r as y,k as H,w as K,n as _,v as Q,e as l}from"./index-Duw_mHSu.js";const W={list:w=>h.get("/public/log",{params:w})},X={overview(){return h.get("/public/stats")}},Y={overview(){return h.get("/public/display")}},Z={class:"min-h-screen overflow-x-hidden bg-card/70 text-foreground backdrop-blur"},ee={class:"mx-auto w-full max-w-6xl min-w-0 px-4 py-8"},te={class:"rounded-3xl border border-border bg-card p-6"},se={class:"flex flex-wrap items-start justify-between gap-4"},re={class:"flex items-center gap-3"},oe=["src"],le={class:"mt-4 flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-border bg-secondary/40 px-4 py-3"},ae=["href"],ne={key:1,class:"text-xs text-muted-foreground"},ue={class:"mt-4 grid grid-cols-2 gap-3 md:grid-cols-4"},ie={class:"text-[11px] text-muted-foreground"},ce={key:0,class:"mt-4 rounded-2xl border border-destructive/30 bg-destructive/10 p-4 text-sm text-destructive"},de={key:1,class:"mt-4 rounded-2xl border border-border bg-secondary/30 px-4 py-6 text-center text-sm text-muted-foreground"},pe={key:2,class:"mt-4 max-h-[60vh] space-y-3 overflow-y-auto pr-1 scrollbar-slim"},be=["onClick"],me={class:"text-muted-foreground"},xe={class:"text-muted-foreground"},fe={class:"space-y-2 px-4 py-3"},ve={class:"text-muted-foreground"},ge={class:"flex-1 text-foreground"},N=1e3,_e=J({__name:"PublicLogs",setup(w){const u=c([]),b=c(null),m=c(null),d=c(""),$=c("--:--"),p=c({});let x;const D=i(()=>m.value?.logo_url?.trim()||"/logo.svg"),k=i(()=>m.value?.chat_url?.trim()||""),j=i(()=>u.value.length),f=i(()=>u.value.filter(e=>e.status==="success").length),C=i(()=>u.value.filter(e=>e.status==="error").length),A=i(()=>{let e=0,t=0;return u.value.forEach(r=>{r.status==="success"&&r.events.forEach(a=>{if(a.type!=="complete")return;const L=a.content.match(/([0-9]+(?:\.[0-9]+)?)\s*s/);L&&(e+=Number(L[1]),t+=1)})}),t===0?"-":`${(e/t).toFixed(1)}s`}),F=i(()=>{const e=f.value+C.value;return e===0?"-":`${(f.value/e*100).toFixed(1)}%`}),I=i(()=>[{label:"总访客",value:b.value?.total_visitors??0},{label:"每分钟请求",value:b.value?.requests_per_minute??0,color:b.value?.load_color},{label:"平均响应",value:A.value},{label:"成功率",value:F.value,color:"#10b981"},{label:"对话次数",value:j.value},{label:"成功",value:f.value,color:"#10b981"},{label:"失败",value:C.value,color:"#ef4444"},{label:"更新时间",value:$.value,color:"#6b7280"}]),R=e=>e==="success"?"成功":e==="error"?"失败":e==="timeout"?"超时":"进行中",U=e=>{const t="rounded-md px-2 py-0.5 text-[11px] font-semibold";return e==="success"?`${t} bg-emerald-100 text-emerald-700`:e==="error"?`${t} bg-rose-100 text-rose-700`:e==="timeout"?`${t} bg-amber-100 text-amber-700`:`${t} bg-amber-100 text-amber-700`},z=e=>e.type==="start"?"开始对话":e.type==="select"?"选择":e.type==="retry"?"重试":e.type==="switch"?"切换":e.type==="complete"?e.status==="success"?"完成":e.status==="error"?"失败":e.status==="timeout"?"超时":"完成":"事件",E=e=>{const t="rounded-md px-2 py-0.5 text-[11px] font-semibold";if(e.type==="start")return`${t} bg-blue-100 text-blue-700`;if(e.type==="select")return`${t} bg-violet-100 text-violet-700`;if(e.type==="retry")return`${t} bg-amber-100 text-amber-700`;if(e.type==="switch")return`${t} bg-cyan-100 text-cyan-700`;if(e.type==="complete"){if(e.status==="success")return`${t} bg-emerald-100 text-emerald-700`;if(e.status==="error")return`${t} bg-rose-100 text-rose-700`;if(e.status==="timeout")return`${t} bg-amber-100 text-amber-700`}return`${t} bg-slate-100 text-slate-600`},P=()=>{try{const e=localStorage.getItem("public-log-fold-state");e&&(p.value=JSON.parse(e))}catch{p.value={}}},T=()=>{localStorage.setItem("public-log-fold-state",JSON.stringify(p.value))},v=e=>p.value[e]===!0,V=e=>{p.value[e]=!v(e),T()},S=async()=>{d.value="";try{const[e,t]=await Promise.all([W.list({limit:N}),X.overview()]);u.value=e.logs,b.value=t,$.value=new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(e){d.value=e.message||"日志加载失败"}},G=async()=>{try{m.value=await Y.overview()}catch{m.value=null}};return M(()=>{P(),G(),S(),x=window.setInterval(S,3e3)}),O(()=>{x&&window.clearInterval(x)}),(e,t)=>(l(),o("div",Z,[s("div",ee,[s("section",te,[s("div",se,[s("div",re,[s("img",{src:D.value,alt:"Gemini Business2API",class:"h-8 w-8 object-contain"},null,8,oe),t[0]||(t[0]=s("div",null,[s("p",{class:"text-base font-semibold text-foreground"},"公开日志")],-1))]),t[1]||(t[1]=s("div",{class:"flex items-center gap-2 text-xs text-muted-foreground"},[s("span",null,"自动刷新：3s")],-1))]),s("div",le,[s("div",{class:"text-xs text-muted-foreground"},[t[2]||(t[2]=B(" 展示最近 ",-1)),s("span",{class:"font-semibold text-foreground"},n(N)),t[3]||(t[3]=B(" 条会话日志 ",-1))]),k.value?(l(),o("a",{key:0,href:k.value,target:"_blank",class:"text-xs font-medium text-emerald-600 transition hover:text-emerald-500"}," 开始对话 ",8,ae)):(l(),o("span",ne,"开始对话"))]),s("div",ue,[(l(!0),o(g,null,y(I.value,r=>(l(),o("div",{key:r.label,class:"rounded-2xl border border-border bg-card px-4 py-3 text-center"},[s("div",ie,n(r.label),1),s("div",{class:"mt-1 text-lg font-semibold",style:H({color:r.color||void 0})},n(r.value),5)]))),128))]),d.value?(l(),o("div",ce,n(d.value),1)):q("",!0),u.value.length===0&&!d.value?(l(),o("div",de," 暂无日志 ")):u.value.length>0?(l(),o("div",pe,[(l(!0),o(g,null,y(u.value,r=>(l(),o("div",{key:r.request_id,class:"rounded-2xl border border-border bg-card"},[s("button",{type:"button",class:"flex w-full flex-wrap items-center gap-2 rounded-2xl bg-secondary/40 px-4 py-3 text-left text-xs transition hover:bg-secondary/60",onClick:a=>V(r.request_id)},[s("span",{class:_(U(r.status))},n(R(r.status)),3),s("span",me,"req_"+n(r.request_id),1),s("span",xe,n(r.events.length)+" 条事件",1),s("span",{class:_(["ml-auto text-muted-foreground transition-transform",{"rotate-90":!v(r.request_id)}])}," ▸ ",2)],8,be),K(s("div",fe,[(l(!0),o(g,null,y(r.events,a=>(l(),o("div",{key:`${r.request_id}-${a.time}-${a.type}`,class:"flex flex-wrap items-center gap-3 rounded-xl border border-border bg-card px-3 py-2 text-xs"},[s("div",ve,n(a.time),1),s("span",{class:_(E(a))},n(z(a)),3),s("div",ge,n(a.content),1)]))),128))],512),[[Q,!v(r.request_id)]])]))),128))])):q("",!0)])])]))}});export{_e as default};
