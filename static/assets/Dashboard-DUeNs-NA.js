import{g as A,d as N,h as n,i as B,o as F,j,c as u,a,F as z,r as L,t as c,f as D,z as O,b as E,k as V,n as G,e as i}from"./index-Duw_mHSu.js";import{_ as U}from"./HelpTip.vue_vue_type_script_setup_true_lang-D5ftbZH0.js";const $={overview(){return A.get("/admin/stats")}},H={class:"space-y-8"},I={class:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4"},J={class:"text-xs uppercase tracking-[0.3em] text-muted-foreground"},K={class:"mt-4 text-3xl font-semibold text-foreground"},P={class:"mt-2 text-xs text-muted-foreground"},Q={class:"dashboard-split flex w-full flex-col gap-6"},W={class:"dashboard-main w-full min-w-0 rounded-3xl border border-border bg-card p-6 overflow-hidden"},X={class:"mt-6 border-t border-border pt-6"},Y={class:"dashboard-side w-full min-w-0 rounded-3xl border border-border bg-card p-6"},Z={class:"mt-6 space-y-4"},ee={class:"flex items-center justify-between text-sm"},te={class:"flex items-center gap-2 text-muted-foreground"},ae={class:"font-medium text-foreground"},le={class:"h-2 w-full rounded-full bg-secondary"},ne=N({__name:"Dashboard",setup(oe){const r=n([{label:"账号总数",value:"0",caption:"账号池中已加载的总数量。"},{label:"活跃账号",value:"0",caption:"未过期、未禁用、未限流且可用。"},{label:"失败账号",value:"0",caption:"自动禁用或已过期，需要处理。"},{label:"限流账号",value:"0",caption:"触发 429 限流，冷却中。"}]),f=n([]),h=n([]),b=n([]),x=n({}),m=n(null),p=n(null);let o=null,s=null;const k=B(()=>{const e=Math.max(Number(r.value[0].value),1),t=Number(r.value[1].value),l=Number(r.value[2].value),d=Number(r.value[3].value),v=Math.max(e-t-l-d,0);return[{label:"活跃",value:t,percent:Math.round(t/e*100),barClass:"bg-emerald-500"},{label:"失败",value:l,percent:Math.round(l/e*100),barClass:"bg-destructive"},{label:"限流",value:d,percent:Math.round(d/e*100),barClass:"bg-amber-300"},{label:"空闲",tooltip:"未限流、未失败、未激活使用中的账号（主要是手动禁用）。",value:v,percent:Math.round(v/e*100),barClass:"bg-slate-300"}]});F(async()=>{await R(),M(),q(),window.addEventListener("resize",_)}),j(()=>{window.removeEventListener("resize",_),o&&(o.dispose(),o=null),s&&(s.dispose(),s=null)});function M(){const e=window.echarts;!e||!m.value||(o=e.init(m.value),g(),w())}function q(){const e=window.echarts;!e||!p.value||(s=e.init(p.value),y(),S())}function g(){o&&(o.setOption({tooltip:{trigger:"axis"},legend:{data:["总请求","失败/限流"],right:0,top:0,textStyle:{color:"#6b6b6b",fontSize:11}},grid:{left:24,right:16,top:44,bottom:24,containLabel:!0},xAxis:{type:"category",data:b.value,boundaryGap:!1,axisLine:{lineStyle:{color:"#d4d4d4"}},axisTick:{show:!1},axisLabel:{color:"#6b6b6b",fontSize:10}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#6b6b6b",fontSize:10},splitLine:{lineStyle:{color:"#e5e5e5"}}},series:[{name:"总请求",type:"line",data:f.value,smooth:!0,showSymbol:!1,lineStyle:{width:3},itemStyle:{color:"#0ea5e9"}},{name:"失败/限流",type:"line",data:h.value,smooth:!0,showSymbol:!1,lineStyle:{width:2},itemStyle:{color:"#f59e0b"}}]}),w())}function y(){if(!s)return;const e=Object.entries(x.value).map(([t,l])=>({name:t,type:"line",stack:"models",data:l,smooth:!0,showSymbol:!1,areaStyle:{opacity:.2},lineStyle:{width:1.5},itemStyle:{color:T(t)}}));s.setOption({tooltip:{trigger:"axis"},legend:{data:e.map(t=>t.name),right:0,top:0,textStyle:{color:"#6b6b6b",fontSize:11}},grid:{left:24,right:16,top:44,bottom:24,containLabel:!0},xAxis:{type:"category",data:b.value,boundaryGap:!1,axisLine:{lineStyle:{color:"#d4d4d4"}},axisTick:{show:!1},axisLabel:{color:"#6b6b6b",fontSize:10}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#6b6b6b",fontSize:10},splitLine:{lineStyle:{color:"#e5e5e5"}}},series:e}),S()}function _(){o&&o.resize(),s&&s.resize()}async function R(){try{const e=await $.overview();r.value[0].value=(e.total_accounts??0).toString(),r.value[1].value=(e.active_accounts??0).toString(),r.value[2].value=(e.failed_accounts??0).toString(),r.value[3].value=(e.rate_limited_accounts??0).toString();const t=e.trend||{labels:[],total_requests:[],failed_requests:[],rate_limited_requests:[]};b.value=t.labels||[],f.value=t.total_requests||[];const l=t.failed_requests||[],d=t.rate_limited_requests||[];h.value=f.value.map((v,C)=>(l[C]||0)+(d[C]||0)),x.value=t.model_requests||{},g(),y()}catch(e){console.error("Failed to load overview:",e)}}function w(){o&&requestAnimationFrame(()=>{o?.resize()})}function S(){s&&requestAnimationFrame(()=>{s?.resize()})}function T(e){return{"gemini-3-pro-preview":"#2563eb","gemini-2.5-pro":"#10b981","gemini-2.5-flash":"#f97316","gemini-3-flash-preview":"#8b5cf6","gemini-auto":"#64748b"}[e]||"#94a3b8"}return(e,t)=>(i(),u("div",H,[a("section",I,[(i(!0),u(z,null,L(r.value,l=>(i(),u("div",{key:l.label,class:"rounded-3xl border border-border bg-card p-6"},[a("p",J,c(l.label),1),a("p",K,c(l.value),1),a("p",P,c(l.caption),1)]))),128))]),a("section",Q,[a("div",W,[t[1]||(t[1]=a("div",{class:"flex items-center justify-between"},[a("p",{class:"text-sm font-medium text-foreground"},"调用趋势（近12小时）")],-1)),a("div",{ref_key:"trendChartRef",ref:m,class:"mt-6 h-56 w-full max-w-full lg:h-64"},null,512),a("div",X,[t[0]||(t[0]=a("p",{class:"text-sm font-medium text-foreground"},"模型调用分布（近12小时）",-1)),a("div",{ref_key:"modelChartRef",ref:p,class:"mt-4 h-56 w-full max-w-full lg:h-64"},null,512)])]),a("div",Y,[t[2]||(t[2]=a("p",{class:"text-sm font-medium text-foreground"},"账号健康",-1)),a("div",Z,[(i(!0),u(z,null,L(k.value,l=>(i(),u("div",{key:l.label,class:"space-y-2"},[a("div",ee,[a("span",te,[D(c(l.label)+" ",1),l.tooltip?(i(),O(U,{key:0,text:l.tooltip},null,8,["text"])):E("",!0)]),a("span",ae,c(l.value),1)]),a("div",le,[a("div",{class:G(["h-2 rounded-full",l.barClass]),style:V({width:l.percent+"%"})},null,6)])]))),128))]),t[3]||(t[3]=a("div",{class:"mt-6 rounded-2xl border border-border bg-secondary/50 p-4 text-xs text-muted-foreground"}," 建议及时处理失败或过期账号，避免影响轮询效率。 ",-1))])])]))}});export{ne as default};
