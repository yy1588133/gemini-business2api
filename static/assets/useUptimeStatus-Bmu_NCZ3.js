import{g as d,h as r,i as c}from"./index-DNHZiZJh.js";const f={uptime(t=90){return d.get("/public/uptime",{params:{days:t}})}},b=4e4,w=60,g=t=>t==="up"?"正常":t==="warn"?"注意":t==="down"?"异常":"未知",h=t=>t==="up"?"monitor-badge--up":t==="warn"?"monitor-badge--warn":t==="down"?"monitor-badge--down":"monitor-badge--unknown",v=(t=[])=>{const a=[];for(let s=0;s<w;s+=1)if(s<t.length){const e=t[s],u=e.latency_ms??null,l=e.success&&u!==null&&u>b,o=e.level??(l?"warn":e.success?"up":"down"),n=o==="warn"?"monitor-beat--warn":o==="up"?"monitor-beat--up":"monitor-beat--down",i=u!==null?` · 首响 ${(Math.max(u,0)/1e3).toFixed(1)}s`:"",m=e.status_code?` · HTTP ${e.status_code}`:"",p=o==="warn"?"警告":e.success?"成功":"失败";a.push({className:n,tooltip:`${e.time} · ${p}${m}${i}`})}else a.push({className:"monitor-beat--empty",tooltip:null});return a};function y(){const t=r(null),a=r(""),s=r(!1),e=c(()=>t.value?.updated_at??"");return{services:c(()=>t.value?Object.entries(t.value.services).map(([o,n])=>({key:o,name:n.name,statusLabel:g(n.status),statusClass:h(n.status),uptime:n.uptime,total:n.total,success:n.success,beats:v(n.heartbeats)})):[]),updatedAt:e,errorMessage:a,isLoading:s,refreshStatus:async()=>{if(!s.value){s.value=!0,a.value="";try{t.value=await f.uptime()}catch(o){a.value=o.message||"监控数据获取失败"}finally{s.value=!1}}}}}export{y as u};
